# ğŸ› ï¸ Makefile cockpitizado para visor y backend federado

# Variables generales
VISOR_DIR=web-build
BACKEND_IMAGE=backend-cockpit
VISOR_IMAGE=visor-frontend
PORT=8081

# ğŸ”§ Exportar visor
exportar:
	npx expo export --output-dir $(VISOR_DIR)

# ğŸ” Validar visor
validar:
	./validar-visor.sh

# ğŸ§¹ Limpiar contexto
limpiar:
	./limpiar-contexto.sh

# ğŸ—ï¸ Build backend
build-backend:
	docker build -t $(BACKEND_IMAGE) .

# ğŸ—ï¸ Build visor
build-visor:
	docker build -t $(VISOR_IMAGE) .

# ğŸš€ Levantar visor local
up-visor:
	docker-compose up -d

# ğŸ›‘ Detener visor local
down-visor:
	docker-compose down

# ğŸŒ Abrir visor en navegador
abrir:
	xdg-open http://localhost:$(PORT)/index.html || start http://localhost:$(PORT)/index.html || open http://localhost:$(PORT)/index.html

# ğŸš€ Desplegar visor en producciÃ³n
prod:
	docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# ğŸŒ Targets federados por paÃ­s

# ğŸ‡¨ğŸ‡± Chile
exportar-CL:
	npx expo export --output-dir $(VISOR_DIR)/CL

validar-CL:
	./validar-visor.sh CL

deploy-CL:
	docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# ğŸ‡²ğŸ‡½ MÃ©xico
exportar-MX:
	npx expo export --output-dir $(VISOR_DIR)/MX

validar-MX:
	./validar-visor.sh MX

deploy-MX:
	docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# ğŸ‡ªğŸ‡¸ EspaÃ±a
exportar-ES:
	npx expo export --output-dir $(VISOR_DIR)/ES

validar-ES:
	./validar-visor.sh ES

deploy-ES:
	docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# ğŸ§  DiagnÃ³stico tÃ©cnico
verificar:
	./verificar-contexto.sh

# ğŸ“‹ Ayuda
help:
	@echo "Comandos disponibles:"
	@echo "  make exportar        â†’ Exporta visor general"
	@echo "  make validar         â†’ Valida visor general"
	@echo "  make limpiar         â†’ Limpia contexto Docker"
	@echo "  make build-backend   â†’ Build backend cockpitizado"
	@echo "  make build-visor     â†’ Build visor cockpitizado"
	@echo "  make up-visor        â†’ Levanta visor local"
	@echo "  make down-visor      â†’ Detiene visor local"
	@echo "  make abrir           â†’ Abre visor en navegador"
	@echo "  make prod            â†’ Despliega visor en producciÃ³n"
	@echo "  make exportar-CL     â†’ Exporta visor para Chile"
	@echo "  make validar-MX      â†’ Valida visor para MÃ©xico"
	@echo "  make deploy-ES       â†’ Despliega visor para EspaÃ±a"
	@echo "  make verificar       â†’ DiagnÃ³stico tÃ©cnico del entorno"
